{% import "macros.html" as lib %}
{# Retreive configuration variables #}
{% block config %}
{% endblock config %}
{# Retreive site index with proper language #}
{% if lang == config.default_language %}
  {% set index = get_section(path="_index.md", metadata_only=true) %}
{% else %}
  {% set index = get_section(path="_index."~lang~".md", metadata_only=true) %}
{% endif %}
{# Retreive template translations #}
{% set i18ns = load_data(path="data/i18n.yml", required=false) %}
{% if not i18ns %}
  {% set i18ns = load_data(path=config.extra.path~"/data/i18n.yml") %}
{% endif %}
{% set i18n = i18ns[lang] %}
{# Retreive predefined icons #}
{% set icons = load_data(path="data/icon.yml", required=false) %}
{% if not icons %}
  {% set icons = load_data(path=config.extra.path~"/data/icon.yml") %}
{% endif %}
{# The actual page #}
<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    {% block head_prepend %}
    {% endblock head_prepend %}
    {% include "head.html" %}
    {% block head_append %}
    {% endblock head_append %}
  </head>
  <body id="top">
    {% block body_prepend %}
    {% endblock body_prepend %}
    <header>
      {% block header_prepend %}
      {% endblock header_prepend %}
      {% include "header.html" %}
      {% block header_append %}
      {% endblock header_append %}
    </header>
    <nav id="global-nav" aria-label="{{ i18n.nav }}">
      {% block nav_prepend %}
      {% endblock nav_prepend %}
      {% include "nav.html" %}
      {% block nav_append %}
      {% endblock nav_append %}
    </nav>
    {% if toc %}
      {% if toc | length > 1 or toc[0].children %}
        <nav id="toc" aria-label="{{ i18n.toc }}">
          {% block toc_prepend %}
          {% endblock toc_prepend %}
          {{ lib::toc(toc=toc) }}
          {% block toc_append %}
          {% endblock toc_append %}
        </nav>
      {% endif %}
    {% endif %}
    <main class="{{ self | default(value="404") }}">
      {% block main %}
      {% endblock main %}
    </main>
    <footer>
      <ul>
        {% block footer_prepend %}
        {% endblock footer_prepend %}
        <li>Â© {{ config.extra.creation_year }}-{{ now() |date(format="%Y") }} {{ config.extra.author }}</li>
        <li>{{ i18n.last_updated | capitalize }} {{ now() |date(format="%d/%m/%Y") }}</li>
        {% block footer_append %}
          <li>
            {{ i18n.generated | capitalize }} <a href="https://www.getzola.org">Zola</a>,
            {{ i18n.using }} <a href="https://github.com/gfauredev/Neutral-Zola-Theme">{{ i18n.website_base }}</a>
          </li>
        {% endblock footer_append %}
      </ul>
    </footer>
    {% block body_append %}
      {{ lib::return_top(label=i18n.return_top) }}
    {% endblock body_append %}
  </body>
</html>
