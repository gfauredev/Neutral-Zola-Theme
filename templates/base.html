{% import "macros.html" as lib %}
{# Retreive configuration variables #}
{% block config %}
  {% if not permalink %}
    {% set permalink = "404" %}
  {% endif %}
{% endblock config %}
{# Retreive site index with proper language #}
{% if lang == config.default_language %}
  {% set index = get_section(path="_index.md", metadata_only=true) %}
{% else %}
  {% set index = get_section(path="_index."~lang~".md", metadata_only=true) %}
{% endif %}
{# Retreive template translations #}
{% set i18ns = load_data(path="data/i18n.yml", required=false) %}
{% if not i18ns %}
  {% set i18ns = load_data(path=config.extra.path~"/data/i18n.yml") %}
{% endif %}
{% set i18n = i18ns[lang] %}
{# Retreive predefined icons #}
{% set icons = load_data(path="data/icon.yml", required=false) %}
{% if not icons %}
  {% set icons = load_data(path=config.extra.path~"/data/icon.yml") %}
{% endif %}
{# The actual page #}
<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    {% block head_prepend %}
    {% endblock head_prepend %}
    {% block head %}
      {# Metadata #}
      <meta charset="utf-8">
      <title>{{ title | default(value="Error 404") }}</title>
      {% if config.extra.author %}<meta name="author" content="{{ config.extra.author }}">{% endif %}
      <meta name="description"
            content="{{ description | default(value=config.description) }}">
      <meta name="og:description"
            content="{{ description | default(value=config.description) }}">
      <meta name="og:title" content="{{ title | default(value="Error 404") }}">
      <meta property="og:type" content="website">
      <meta property="og:site_name" content="{{ config.title }}">
      {% if permalink %}<meta name="og:url" content="{{ permalink }}">{% endif %}
      <meta name="viewport" content="width=device-width, initial-scale=1">
      {# Additional metadata #}
      {{ lib::file2tags(tag="meta") }}
      {# Translations #}
      {% if translations %}
        {% for translation in translations %}
          <link rel="alternate"
                hreflang="{{ translation.lang }}"
                href="{{ translation.permalink }}">
        {% endfor %}
        {# Disable auto translation, we have our own #}
        <meta name="google" content="notranslate">
      {% endif %}
      {# ICO icons 16×16, 32×32, (48×48), (64×64) #}
      <link rel="icon" href="/favicon.ico" sizes="any">
      {# Vector (SVG) icon #}
      <link rel="icon" href="/icon.svg" type="image/svg+xml">
      {# PNG 180×180 icon #}
      <link rel="apple-touch-icon" href="/icon.png" type="image/png">
      {# Import links #}
      {{ lib::file2tags(tag="link") }}
      {# Import scripts #}
      {{ lib::file2tags(tag="script") }}
    {% endblock head %}
    {% block head_append %}
    {% endblock head_append %}
  </head>
  <body id="top">
    {% block body_prepend %}
    {% endblock body_prepend %}
    <header>
      {% block header_prepend %}
      {% endblock header_prepend %}
      {% block header %}
        {% if config.extra.logo %}
          <a href="{{ root.permalink | safe }}">
            {% set resized_logo = resize_image(path=config.extra.logo, height=250, op="fit_height", format="webp") %}
            <img class="logo"
                 width="150"
                 height="150"
                 src="{{ resized_logo.url }}"
                 alt="Logo">
          </a>
        {% endif %}
      {% endblock header %}
      {% block header_append %}
      {% endblock header_append %}
    </header>
    <nav id="NAV" aria-label="{{ i18n.nav }}">
      {% block nav_prepend %}
      {% endblock nav_prepend %}
      {% block nav %}
        {# Translations #}
        {{ lib::next_translation(translations=translations | default(value=[]) ) }}
        {# Index #}
        {{ lib::nav_link(title=index.title, permalink=permalink, link_permalink=index.permalink) }}
        {# Taxonomies #}
        {% for taxonomy in config.taxonomies %}
          {% set taxonomy = get_taxonomy(kind=taxonomy.name, lang=lang) %}
          {{ lib::nav_link(title=taxonomy.name, permalink=permalink, link_permalink=taxonomy.permalink) }}
        {% endfor %}
        {# Subsections #}
        {% for subsection in index.subsections %}
          {% set subsection = get_section(path=subsection, metadata_only=true) %}
          {{ lib::nav_link(title=subsection.title, permalink=permalink, link_permalink=subsection.permalink) }}
        {% endfor %}
        {# Social links #}
        {{ lib::social_links(links=config.extra.social_links | default(value=[]) ) }}
      {% endblock nav %}
      {% block nav_append %}
      {% endblock nav_append %}
    </nav>
    <div class="overbox">
      <div class="center">
        <main class="{{ self | default(value="404") }}">
          {% block main_prepend %}
            {{ lib::info(i18n=i18n) }}
          {% endblock main_prepend %}
          {% block main %}
          {% endblock main %}
          {% block main_append %}
          {% endblock main_append %}
        </main>
        {% if toc | default(value=[]) | length > 1 or toc[0].children %}
          <aside>
            <nav id="TOC" aria-label="{{ i18n.toc }}">
              {% block toc_prepend %}
                <h2>{{ i18n.toc | capitalize }}</h2>
              {% endblock toc_prepend %}
              {{ lib::toc(toc=toc) }}
              {% block toc_append %}
              {% endblock toc_append %}
            </nav>
            {{ lib::return_to(label=i18n.return_toc, id="TOC") }}
          </aside>
        {% endif %}
      </div>
    </div>
    <footer>
      <ul>
        {% block footer_prepend %}
        {% endblock footer_prepend %}
        <li>© {{ config.extra.creation_year }}-{{ now() |date(format="%Y") }} {{ config.extra.author }}</li>
        <li>{{ i18n.last_updated | capitalize }} {{ now() |date(format="%d/%m/%Y") }}</li>
        {% block footer_append %}
          <li>
            {{ i18n.generated | capitalize }} <a href="https://www.getzola.org">Zola</a>,
            {{ i18n.using }} <a href="https://github.com/gfauredev/Neutral-Zola-Theme">{{ i18n.website_base }}</a>
          </li>
        {% endblock footer_append %}
      </ul>
    </footer>
    {% block body_append %}
    {% endblock body_append %}
  </body>
</html>
